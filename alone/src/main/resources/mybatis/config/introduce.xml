<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- MyBatis에서 namespace는 필수적으로 명시해야 함 -->
<mapper namespace="introduce">
	<resultMap type="introduceVO" id="introduceRM">
		<result column="image_name" property="imageVO.imageName"/>
		<result column="nickname" property="memberVO.nickName"/>
		<result column="board_no" property="boardNo"/>
		<result column="company_name" property="companyName"/>
		<result column="business_hours" property="businessHours"/>
		<result column="category_no" property="categoryVO.categoryNo"/>
	</resultMap>
	<resultMap type="keyWordVO" id="keyWordRM">
		<result column="keyword_name" property="keyWordName" />
	</resultMap>
	<resultMap type="introduceCategoryVO" id="introduceCategoryRM">
		<result column="category_no" property="categoryNo" />
		<result column="category_name" property="categoryName" />
	</resultMap>
	<select id="introduceList" resultMap="introduceRM" parameterType="hashMap">
     select board_no,nickname,region from
     (select row_number() over(order by board.board_no) as rnum,introduce.board_no,member.nickname,introduce.region from
     board board,member member,introduce introduce
     where introduce.category_no=#{categoryNo} and member.id=board.id and board.board_no=introduce.board_no) 
	 where rnum between #{pagingBean.startRowNumber} and #{pagingBean.endRowNumber}   
	</select>
	<select id="getTotalContentCount" resultType="int" parameterType="int"> 
		select count(*) from introduce introduce,introduce_category introduce_category 
		where introduce.category_no = introduce_category.category_no and introduce_category.category_no = #{value}
	</select>
	<select id="keyWordList" resultMap="keyWordRM" resultType="keyWordVO">
		select keyword_name
		from keyword
		where keyword.board_no=#{value}
	</select>
	
	<select id="introduceCategoryList" resultType="introduceCategoryVO" resultMap="introduceCategoryRM">
		select category_no, category_name from introduce_category
	</select>
	
		<select id="introduceDetail" resultMap="introduceRM" parameterType="int"> 
		select  board.content, introduce.location, introduce.business_hours, introduce.tel 
		from introduce introduce,board board 
		where board.board_no=introduce.board_no and introduce.board_no=#{value}
		</select>
		
    <insert id="boardWrite" parameterType="introduceVO">
		<selectKey resultType="int" keyProperty="boardNo" order="BEFORE">
			select board_seq.nextval from dual
		</selectKey>
		insert into board(board_no, id, content, time_posted)
		values(#{boardNo}, #{memberVO.id}, #{content}, sysdate)
	</insert>
	
	<update id="updateWrite" parameterType="string">
	
		update companymember set write = write+1 where id=#{value} 
	</update>
	
	<insert id="introduceWrite" parameterType="introduceVO" >
		insert into introduce(board_no, company_name, region, location, business_hours,tel,category_no )
		values(#{boardNo}, #{companyName}, #{region}, #{location}, #{businessHours},#{tel},#{categoryVO.categoryNo})
	</insert>
	
	<insert id="keywordRegister" parameterType="keywordVO"  >
		<selectKey resultType="int" keyProperty="keyWordNo" order="BEFORE">
			select board_seq.nextval from dual
		</selectKey>
	insert into KEYWORD(keyword_no,keyword_name,board_no) 
     values(#{keyWordNo}, #{keyWordName},#{boardNo})
	</insert>
</mapper>