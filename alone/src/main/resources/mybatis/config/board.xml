<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- MyBatis에서 namespace는 필수적으로 명시해야 함 -->
<mapper namespace="board">
	<resultMap type="imageVO" id="imageRM">
		<result column="image_name" property="imageName" />
	</resultMap>

	<select id="imageList" resultMap="imageRM" resultType="imageVO">
		select
		image.image_name
		from image image, board board
		where image.board_no=board.board_no and board.board_no=#{value}
	</select>
	<select id="introduceFirstImage" resultMap="imageRM" resultType="imageVO">
		select image_name
		from image
		where image_no = (
		select min(image.image_no)
		from image image, board board
		where board.board_no=#{value} and board.board_no=image.board_no
		)
	</select>

	<select id="commentList" resultType="commentVO">
		select boardcomment.content,member.nickname as "memberVO.nickName",
		boardcomment.comment_no as commentNo,
		member.id as "memberVO.id",to_char(boardcomment.time_posted,'yyyy.mm.dd') as
		timePosted
		from BOARDCOMMENT boardcomment,member member
		where boardcomment.id=member.id and boardcomment.board_no=#{value}
		ORDER BY boardcomment.comment_no ASC
	</select>

	<insert id="imageUpload" parameterType="imageVO">
		insert into
		image(image_no, image_name, board_no)
		values(image_seq.nextval, #{imageName}, #{boardNo})
	</insert>

	<insert id="insertComment" parameterType="commentVO">
		<selectKey resultType="integer" keyProperty="commentNo"
			order="BEFORE">
			select comment_seq.nextval from dual
		</selectKey>
		insert into boardcomment(comment_no,board_no,content,time_posted,id)
		values (#{commentNo}, #{boardNo}, #{content}, sysdate, #{memberVO.id})
	</insert>

	<update id="updateComment" parameterType="commentVO">
	update boardcomment set content = #{content} where comment_no=#{commentNo}
	</update>

	<delete id="deleteComment" parameterType="commentVO">
		delete from boardcomment where comment_no = #{commentNo} 
	</delete>
	
	<update id="updateHitBoard" parameterType="int">
	update review set hits=hits+1 where board_no=#{value}
	</update>

	<update id="reviewBoardUpdate" parameterType="reviewVO">
	update board
	set content=#{content}, time_posted=sysdate
	where board_no=#{boardNo}
   </update>

</mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















